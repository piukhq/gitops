apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../bases/deployment
nameSuffix: -event-processor
labels:
- includeSelectors: true
  pairs:
    component: event-processor
patches:
  - patch: |
      - op: add
        path: /spec/template/spec/containers/0/args
        value: ["stormctl", "deploy", "events", "--queues=clickhouse_hermes,tx_export_dw"]
      - op: replace
        path: /spec/template/spec/containers/0/resources
        value:
          requests:
            cpu: 10m
            memory: 256Mi
          limits:
            memory: 256Mi
      - op: add
        path: /spec/template/spec/priorityClassName
        value: bink-high-tasks
    target:
      kind: Deployment
