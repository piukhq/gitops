---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: aqua-agent
  namespace: aqua
spec:
  selector:
    matchLabels:
      app: aqua-agent
  template:
    metadata:
      labels:
        app: aqua-agent
      name: aqua-agent
    spec:
      serviceAccount: aqua-sa
      hostPID: true
      containers:
        - name: aqua-agent
          image: binkcore.azurecr.io/aqua-enforcer:5.0.20261
          securityContext:
            privileged: true
          env:
            - name: AQUA_NODE_NAME
              valueFrom:
                fieldRef:
                  fieldPath: spec.nodeName
            - name: AQUA_TOKEN
              value: 87248a47-4b01-4284-9ae4-87b17bae5979
            - name: AQUA_SERVER
              value: aqua.uksouth.bink.host:30002
            - name: AQUA_LOGICAL_NAME
              value: aqua
            - name: AQUA_MODE
              value: SERVICE
            - name: RESTART_CONTAINERS
              value: 'no'
          volumeMounts:
            - mountPath: /var/run
              name: var-run
            - mountPath: /dev
              name: dev
            - mountPath: /host/sys
              name: sys
              readOnly: true
            - mountPath: /host/proc
              name: proc
              readOnly: true
            - mountPath: /host/etc
              name: etc
              readOnly: true
            - mountPath: /host/opt/aquasec
              name: aquasec
              readOnly: true
            - mountPath: /opt/aquasec/tmp
              name: aquasec-tmp
            - mountPath: /data
              name: aquasec-data
            - mountPath: /opt/aquasec/audit
              name: aquasec-audit
      volumes:
        - name: var-run
          hostPath:
            path: /var/run
        - name: dev
          hostPath:
            path: /dev
        - name: sys
          hostPath:
            path: /sys
        - name: proc
          hostPath:
            path: /proc
        - name: etc
          hostPath:
            path: /etc
        - name: aquasec
          hostPath:
            path: /opt/aquasec
        - name: aquasec-tmp
          hostPath:
            path: /opt/aquasec/tmp
        - name: aquasec-audit
          hostPath:
            path: /opt/aquasec/audit
        - name: aquasec-data
          hostPath:
            path: /opt/aquasec/data
