---
resources:
  - ../../../../bases/olympus/hermes/deployments/api
  - ../../../../bases/olympus/hermes/deployments/beat
  - ../../../../bases/olympus/hermes/deployments/celery
  - ../../../../bases/olympus/hermes/deployments/logic
  - ../../../../bases/olympus/hermes/essentials
  - ingress.yaml

namespace: olympus

configMapGenerator:
  - name: hermes
    envs:
      - env.ini

replicas:
  - name: hermes-celery
    count: 4
  - name: hermes-logic
    count: 4

patches:
  - target:
      kind: Deployment
      name: hermes-api
    patch: |-
      - op: remove
        path: /spec/template/spec/containers/1/livenessProbe
      - op: remove
        path: /spec/template/spec/containers/1/readinessProbe
  - target:
      kind: ServiceProfile
    patch: |-
      - op: replace
        path: /metadata/name
        value: hermes-api.olympus.svc.cluster.local
  - target:
      kind: Deployment|Job
    patch: |
      - op: replace
        path: /spec/template/spec/containers/0/envFrom
        value:
          - configMapRef:
              name: hermes
  - target:
      kind: Deployment
      name: hermes-api
    patch: |-
      - op: add
        path: /spec/template/spec/containers/0/env/-
        value:
          name: SENTRY_SAMPLE_RATE
          value: "0.5"
  - target:
      kind: Deployment
      name: hermes-celery
    patch: |-
      - op: add
        path: /spec/template/spec/containers/0/env/-
        value:
          name: SENTRY_SAMPLE_RATE
          value: "0.01"
  - target:
      kind: Deployment
      name: hermes-beat
    patch: |-
      - op: add
        path: /spec/template/spec/containers/0/env/-
        value:
          name: SENTRY_SAMPLE_RATE
          value: "0.01"
