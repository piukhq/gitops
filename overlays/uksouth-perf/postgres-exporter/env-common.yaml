apiVersion: apps/v1
kind: Deployment
metadata:
  name: postgres-exporter
  namespace: monitoring
spec:
  template:
    metadata:
      annotations:
        prometheus.io/instance: bink-uksouth-perf-common
    spec:
      containers:
      - name: postgres-exporter
        env:
        - name: DATA_SOURCE_NAME
          valueFrom:
            secretKeyRef:
              key: uri
              name: azure-pg-common
        - name: PG_EXPORTER_WEB_LISTEN_ADDRESS
          value: ":9100"
        - name: PG_EXPORTER_CONSTANT_LABELS
          value: "server=bink-uksouth-perf-common"
        - name: PG_EXPORTER_AUTO_DISCOVER_DATABASES
          value: "true"
        - name: PG_EXPORTER_EXCLUDE_DATABASES
          value: azure_maintenance,azure_sys,template0,template1,postgres
