apiVersion: apps/v1
kind: Deployment
metadata:
  name: harmonia
spec:
  template:
    spec:
      containers:
      - name: app
        env:
        - name: TXM_BLOB_STORAGE_DSN
          valueFrom:
            secretKeyRef:
              key: connection_string
              name: azure-storage-common
        - name: TXM_DEBUG
          value: "true"
        - name: TXM_HERMES_URL
          value: http://hermes-pcui-endpoint-mock-api/pcui-mock
        - name: TXM_EUROPA_URL
          value: http://europa-api/config_service
        - name: TXM_ATLAS_URL
          value: http://atlas-api/audit
        - name: TXM_HERMES_SLUG_FORMAT_STRING
          value: '{}-mock'
        - name: TXM_SENTRY_DSN
          value: https://39134637f8aa4bd190c23db0b23f6413@o503751.ingest.sentry.io/5609964
        - name: TXM_SENTRY_ENV
          value: performance
        - name: TXM_AMQP_DSN
          value: amqps://perf-rabbitmq.uksouth.bink.host:5671
        - name: TXM_VAULT_URL
          value: https://bink-uksouth-perf-com.vault.azure.net/
        - name: TXM_SIMULATE_EXPORTS
          value: 'true'
        - name: TXM_AAD_TENANT_ID
          value: a6e2367a-92ea-4e5a-b565-723830bcc095
        - name: SENTRY_SAMPLE_RATE
          value: '0.5'
        - name: TXM_RABBITMQ_HOST # dummy record, not used
          value: dummy
        - name: TXM_RABBITMQ_PORT # dummy record, not used
          value: "1234"
        - name: TXM_RABBITMQ_USER # dummy record, not used
          value: dummy
        - name: TXM_RABBITMQ_PASS # dummy record, not used
          value: dummpy

# Redis Config
        - name: TXM_REDIS_URL
          valueFrom:
            secretKeyRef:
              key: uri_ssl
              name: azure-redis-common # Old Redis
              # name: azure-redis-vnet # New Redis

# Postgres Flexible Server
        - name: TXM_POSTGRES_URI
          valueFrom:
            secretKeyRef:
              name: azure-pgfs
              key: common_harmonia

# Postgres Single Server
        # - name: TXM_POSTGRES_USER
        #   valueFrom:
        #     secretKeyRef:
        #       key: admin_user
        #       name: azure-pg-common
        # - name: TXM_POSTGRES_HOST
        #   value: 127.0.0.1
        # - name: TXM_POSTGRES_DB
        #   value: harmonia
