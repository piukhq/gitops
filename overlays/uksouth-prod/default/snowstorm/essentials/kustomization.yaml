apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - aad.yaml
  - ../../../../../bases/devops/snowstorm/essentials

patches:
  - target:
      kind: Job
      name: snowstorm-migrator
    patch: |
      apiVersion: batch/v1
      kind: Job
      metadata:
        name: snowstorm-migrator
      spec:
        template:
          spec:
            containers:
            - name: app
              env:
                - name: database_dsn
                  valueFrom:
                    secretKeyRef:
                      key: url_snowstorm
                      name: azure-postgres
                - name: storage_account_name
                  valueFrom:
                    secretKeyRef:
                      key: account_name
                      name: azure-storage
                - name: storage_account_auth
                  valueFrom:
                    secretKeyRef:
                      key: key_primary
                      name: azure-storage
