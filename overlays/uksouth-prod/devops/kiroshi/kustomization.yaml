apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../../../bases/devops/kiroshi/essentials
  - ../../../../bases/devops/kiroshi/jobs/migrator
  - ../../../../bases/devops/kiroshi/checks/frontdoor/ranges
  - ../../../../bases/devops/kiroshi/checks/frontdoor/traffic
  - ../../../../bases/devops/kiroshi/checks/spreedly/certs
  - ../../../../bases/devops/kiroshi/storage/blob/itsu
  - ../../../../bases/devops/kiroshi/storage/blob/viator
  - ../../../../bases/devops/kiroshi/storage/sftp/mastercard
  - ../../../../bases/devops/kiroshi/server/images

namespace: devops

patches:
  - target:
      kind: CronJob
      name: kiroshi-traffic
    patch: |
      - op: replace
        path: /spec/suspend
        value: false

  - target:
      kind: CronJob
      name: kiroshi-storage-sftp-mastercard
    patch: |
      - op: replace
        path: /spec/jobTemplate/spec/template/spec/containers/0/args
        value:
          - kiroshi
          - storage
          - sftp
          - --host=files.mastercard.com
          - --user=Z216458
          - --port=16022
          - --key=/mnt/secrets/mastercard-sftp-keyfile
          - --path=/0073185/production/download/TGX2
          - --blob_path=harmonia-imports:mastercard
          - --hacks=mastercard
