---
bases:
  - ../../../../bases/olympus/hades/api
  - ../../../../bases/olympus/hades/migrator

configMapGenerator:
  - name: hades-config
    namespace: default
    envs:
      - env.ini

patches:
  - target:
      kind: Deployment
    patch: |-
      - op: add
        path: /spec/template/spec/containers/0/envFrom
        value:
          - configMapRef:
              name: hades-config
      - op: add
        path: /spec/template/spec/containers/0/env
        value:
          - name: HADES_DATABASE_URL
            valueFrom:
              secretKeyRef:
                name: azure-pgfs
                key: common_hades
