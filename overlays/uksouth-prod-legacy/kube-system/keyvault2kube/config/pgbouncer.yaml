---
pgbouncer.ini: |-
  [databases]
  {%- for server in servers %}
  {%- for db in server.databases %}
  {{ db }} = host={{ server.host }} port={{ server.port }} user={{ server.admin_user }}
  {% endfor %}
  {% endfor %}
  [pgbouncer]
  # Do not change these settings:
  listen_addr = 0.0.0.0
  auth_file = /etc/pgbouncer/userlist.txt
  auth_type = trust
  server_tls_sslmode = verify-ca
  server_tls_ca_file = /etc/root.crt
  # These are defaults and can be configured
  # please leave them as defaults if you are
  # uncertain.
  listen_port = 5432
  unix_socket_dir =
  user = postgres
  pool_mode = session
  default_pool_size = 10
  max_client_conn = 150
  ignore_startup_parameters = extra_float_digits
  admin_users = {% for server in servers %}{{ server.admin_user }}{{ ", " if not loop.last }}{% endfor %}
  # Please add any additional settings below this line
userlist.txt: |-
  {%- for server in servers %}
  "{{ server.admin_user }}" "{{ server.password }}"
  {% endfor %}
