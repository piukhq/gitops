---
resources:
  - ../../../../bases/infrastructure/simpleproxy

namespace: devops

commonLabels:
  app: proxy-redis

patches:
  - target:
      kind: Deployment
    patch: |-
      - op: replace
        path: /metadata/name
        value: proxy-redis
  - target:
      kind: Deployment
    patch: |-
      - op: add
        path: /spec/template/spec/containers/0/env
        value: [
          {"name":"REDIS_HOST","valueFrom":{"secretKeyRef":{"key":"host","name":"azure-redis"}}},
          {"name":"REDIS_PORT","valueFrom":{"secretKeyRef":{"key":"port","name":"azure-redis"}}}
        ]
      - op: add
        path: /spec/template/spec/containers/0/args
        value:
          - -L
          - 0.0.0.0:$(REDIS_PORT)
          - -R
          - $(REDIS_HOST):$(REDIS_PORT)
          - -v
