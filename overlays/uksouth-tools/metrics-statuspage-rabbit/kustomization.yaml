bases:
  - ../../../bases/infrastructure/metrics-statuspage

namespace: statuspage
nameSuffix: -rabbit
commonLabels:
  component: rabbit

patches:
  - target:
      kind: CronJob
    patch: |-
      apiVersion: batch/v1
      kind: CronJob
      metadata:
        name: metrics-statuspage
      spec:
        schedule: "*/15 * * * *"
        jobTemplate:
          spec:
            template:
              spec:
                containers:
                  - name: app
                    args: ["python3", "main.py", "--rabbit"]
                    env:
                      - name: PROMETHEUS_URL
                        value: http://prometheus.default:9090/api/v1/query
